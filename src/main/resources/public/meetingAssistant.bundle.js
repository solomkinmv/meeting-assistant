(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},t=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},n=function(){function n(e){this.restClient=e}return n.prototype.createMeeting=function(){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.restClient.post("/api/meetings/",null)];case 1:return e=t.sent(),console.log("Received response after meeting creation",e),[2,e.id]}}))}))},n.prototype.setIntervals=function(n,o,r){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return console.debug("Setting intervals",n,o,r),[4,this.restClient.put("/api/meetings/".concat(n,"/intervals/").concat(o),{intervals:r})];case 1:return e=t.sent(),console.log("Received response on update of intervals",e),[2,e]}}))}))},n.prototype.getMeeting=function(n){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return console.debug("Getting meeting",n),[4,this.restClient.get("/api/meetings/".concat(n))];case 1:return e=t.sent(),console.log("Received response on meeting retrieval",e),[2,e]}}))}))},n}(),o=function(){function n(){}return n.prototype.get=function(n){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,fetch(n,{method:"GET"})];case 1:return[4,t.sent().json()];case 2:return e=t.sent(),console.log("Received response on get",e),[2,e]}}))}))},n.prototype.post=function(n,o){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})];case 1:return[4,t.sent().json()];case 2:return e=t.sent(),console.log("Received response on post",e),[2,e]}}))}))},n.prototype.put=function(n,o){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})];case 1:return[4,t.sent().json()];case 2:return e=t.sent(),console.log("Received response on put",e),[2,e]}}))}))},n}(),r=function(e,t){this.from=e,this.to=t},i=function(){function e(){}return e.prototype.openNotFound=function(){window.location.href="/404"},e.prototype.openMainPage=function(){window.location.href="/"},e.prototype.openMeetingPage=function(e){window.location.href="/meeting/".concat(e)},e}(),a=function(){function e(){}return e.prototype.getUsername=function(){return sessionStorage.getItem("username")},e.prototype.setUsername=function(e){sessionStorage.setItem("username",e)},e.prototype.setMeeting=function(e){console.log("Setting meeting: ",e),this.meetingId=e.id,this.userIntervals=e.userIntervals,this.intersections=e.intersections},e.prototype.addInterval=function(e){var t=this.userIntervals[this.getUsername()]||[];t.push(e),t.sort((function(e,t){return e.from-t.from}));var n=[];n.push(t[0]);for(var o=1;o<t.length;o++)t[o].from<=n[n.length-1].to?n[n.length-1].to=Math.max(n[n.length-1].to,t[o].to):n.push(t[o]);return this.userIntervals[this.getUsername()]=n,console.log("Updated page state after inserting interval",e,this),n},e}();new(function(){function e(e,t,n){this.pageState=e,this.meetingClient=t,this.navigator=n}return e.prototype.onLoad=function(){var e=this;console.debug("Loading meeting controller"),this.inputIntervalFrom=document.getElementById("intervalFrom"),this.inputIntervalTo=document.getElementById("intervalTo"),this.inputUsername=document.getElementById("name"),this.button=document.getElementById("addInterval"),this.intervalsBlock=document.getElementById("intervals"),this.button.onclick=this.addInterval.bind(this),this.inputUsername.onchange=this.updateUsername.bind(this);var t=window.location.pathname.split("/"),n=t[t.length-1];if(!n)throw new Error("No meeting id found");console.log("Page with meeting id: ",n),this.meetingClient.getMeeting(n).then((function(t){return e.pageState.setMeeting(t)})).then((function(){return e.renderIntervals()})).catch((function(t){console.log("Failed to get meeting ".concat(n,": "),t),e.navigator.openNotFound()})),this.setName(this.pageState.getUsername()||this.promptName())},e.prototype.updateUsername=function(){this.pageState.setUsername(this.inputUsername.value)},e.prototype.promptName=function(){return prompt("Enter your name")},e.prototype.setName=function(e){this.pageState.setUsername(e),this.inputUsername.value=e,console.log("Username: ",e)},e.prototype.addInterval=function(){var e=this,t=new r(this.parseDate(this.inputIntervalFrom.value),this.parseDate(this.inputIntervalTo.value));if(t.from>=t.to)alert("Invalid interval");else{var n=this.pageState.addInterval(t);this.meetingClient.setIntervals(this.pageState.meetingId,this.pageState.getUsername(),n).then((function(t){return e.pageState.setMeeting(t)})).then((function(){return e.renderIntervals()})).catch((function(e){return console.log("Failed to update intervals for user: ",e)}))}},e.prototype.parseDate=function(e){return new Date(e).getTime()},e.prototype.renderIntervals=function(){this.intervalsBlock.innerHTML="";var e=document.createElement("h2");e.innerText="Intervals:",this.intervalsBlock.appendChild(e);for(var t=0,n=Object.entries(this.pageState.userIntervals);t<n.length;t++){var o=n[t],r=o[0],i=o[1],a=document.createElement("h3");a.innerText=r,this.intervalsBlock.appendChild(a);for(var s=0,c=i;s<c.length;s++){var u=c[s];(d=document.createElement("div")).innerText=new Date(u.from).toLocaleString()+" - "+new Date(u.to).toLocaleString(),this.intervalsBlock.appendChild(d)}}var l=document.createElement("h2");l.innerText="Intersections:",this.intervalsBlock.appendChild(l);for(var p=0,h=this.pageState.intersections;p<h.length;p++){var d;u=h[p],(d=document.createElement("div")).innerText=new Date(u.from).toLocaleString()+" - "+new Date(u.to).toLocaleString(),this.intervalsBlock.appendChild(d)}},e}())(new a,new n(new o),new i).onLoad()})();
//# sourceMappingURL=meetingAssistant.bundle.js.map